# rockybot.gridlang

# push directions table [0..3]
  PUSH @EAST
  PUSH @SOUTH
  PUSH @WEST
  PUSH @NORTH

@FOREVER
  CALL << @PUNCHALL
  CALL << @NORTH @LOOKPULL
  CALL << @PUNCHALL
  CALL << @EAST @LOOKPULL
  CALL << @PUNCHALL
  CALL << @SOUTH @LOOKPULL
  CALL << @PUNCHALL
  CALL << @WEST @LOOKPULL

  CALL << @PUNCHALL
@WALK
  PUSH @MOVE
  RAND << 3
  PEEK
  CALLFF << 2
  POP
  GOTO << @FOREVER

@PUNCHALL
  CALL << @NORTH @LOOKPUNCH
  CALL << @EAST @LOOKPUNCH
  CALL << @SOUTH @LOOKPUNCH
  CALL << @WEST @LOOKPUNCH
  RETURN

@LOOKPUNCH  # direction
  PUSH @LOOK
  PEEK << -2
  CALLFF << 2
  EQUAL << @CELL_ROBOT
  IFTGOTO << @DOPUNCH
  POP
  RETURN
@DOPUNCH
  PUSH @PUNCH
  SWAP
  CALLFF << 2
  POP
  RETURN

@LOOKPULL
  PUSH @LOOK
  PEEK << -2
  CALLFF << 2
  EQUAL << @CELL_RESOURCE
  IFTGOTO << @DOPULL
  POP
  RETURN
@DOPULL
  PUSH @PULL
  SWAP
  CALLFF << 2
  POP
  RETURN
